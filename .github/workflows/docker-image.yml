#!/bin/bash

# ===============================
# VPS + SSH + PYTHON + PHP + CLOUDFLARE FREE TUNNEL
# User: sifodz
# Pass: sssddd333
# ===============================

set -e

echo "ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ø¸Ø§Ù…..."
apt update -y && apt upgrade -y

echo "ğŸ“¦ ØªØ«Ø¨ÙŠØª Ø§Ù„Ø­Ø²Ù… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©..."
apt install -y sudo openssh-server apache2 php python3 python3-pip curl unzip tmux

echo "ğŸ‘¤ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… sifodz..."
if id "sifodz" &>/dev/null; then
    echo "Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ù‹Ø§"
else
    useradd -m -s /bin/bash sifodz
    echo "sifodz:sssddd333" | chpasswd
fi

echo "ğŸ”‘ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¥Ù„Ù‰ sudo..."
usermod -aG sudo sifodz

echo "ğŸ› ï¸ Ø¥Ø¹Ø¯Ø§Ø¯ SSH..."
sed -i 's/#PasswordAuthentication yes/PasswordAuthentication yes/g' /etc/ssh/sshd_config
sed -i 's/PasswordAuthentication no/PasswordAuthentication yes/g' /etc/ssh/sshd_config
sed -i 's/PermitRootLogin prohibit-password/PermitRootLogin yes/g' /etc/ssh/sshd_config

systemctl restart ssh
systemctl enable ssh

echo "ğŸŒ ØªØ´ØºÙŠÙ„ Apache..."
systemctl enable apache2
systemctl start apache2

echo "ğŸ“„ Ø¥Ù†Ø´Ø§Ø¡ ØµÙØ­Ø© Ø±Ø¦ÙŠØ³ÙŠØ©..."
cat <<EOF > /var/www/html/index.html
<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>VPS Online</title>
<style>
body {
  background:#020617;
  color:#22d3ee;
  font-family:monospace;
  text-align:center;
  padding-top:50px;
}
.box {
  border:2px solid #22d3ee;
  display:inline-block;
  padding:25px;
}
</style>
</head>
<body>
<div class="box">
<h1>âœ… VPS ÙŠØ¹Ù…Ù„ Ø¨Ù†Ø¬Ø§Ø­</h1>
<p>SSH USER: sifodz</p>
<p>SSH PASS: sssddd333</p>
<p>Python + PHP Installed</p>
<p>Cloudflare Tunnel Active</p>
</div>
</body>
</html>
EOF

chmod 644 /var/www/html/index.html

echo "â˜ï¸ ØªØ«Ø¨ÙŠØª Cloudflare Tunnel..."
wget -q https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-linux-amd64.deb
dpkg -i cloudflared-linux-amd64.deb

echo "ğŸš€ ØªØ´ØºÙŠÙ„ Cloudflare Tunnel Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠ..."
tmux new-session -d -s cloudflare "cloudflared tunnel --url http://localhost:80 --no-autoupdate > /tmp/cloudflare.log 2>&1"

sleep 8

CLOUD_URL=$(grep -o 'https://.*trycloudflare.com' /tmp/cloudflare.log | head -n 1)
IP=$(curl -s ifconfig.me)

echo "=========================================="
echo "âœ… ØªÙ… Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù€ VPS Ø¨Ù†Ø¬Ø§Ø­"
echo ""
echo "ğŸŒ Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø­Ù„ÙŠ:"
echo "http://$IP"
echo ""
echo "â˜ï¸ Ø±Ø§Ø¨Ø· Cloudflare Ø§Ù„Ø¹Ø§Ù… (Ù…Ø¬Ø§Ù†ÙŠ):"
echo "$CLOUD_URL"
echo ""
echo "ğŸ” SSH (Ù…Ù† Termux):"
echo "ssh sifodz@$IP"
echo "Password: sssddd333"
echo "=========================================="
